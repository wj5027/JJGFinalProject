<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="Board">
  	<resultMap type="com.kh.tsp.customer.model.vo.Board" id="boardListSet">
  		<id property="bno" column="BOARD_NO"/>
  		<result property="bTitle" column="BOARD_TITLE"/>
  		<result property="bContext" column="BOARD_CONTEXT"/>
  		<result property="bViews" column="BOARD_VIEWS"/>
  		<result property="createDate" column="CREATION_DATE"/>
  		<result property="modifyDate" column="MODIFED_DATE"/>
  		<result property="bType" column="BOARD_TYPE"/>
  		<result property="status" column="STATUS"/>
  		<result property="mno" column="MEMBER_NO"/>
  		<result property="pno" column="PARKING_NO"/>
  		
  	</resultMap>
  	
  	<resultMap type="com.kh.tsp.customer.model.vo.Board" id="noticeListSet">
  		<id property="bno" column="BOARD_NO"/>
  		<result property="bTitle" column="BOARD_TITLE"/>
  		<result property="bContext" column="BOARD_CONTEXT"/>
  		<result property="bViews" column="BOARD_VIEWS"/>
  		<result property="createDate" column="CREATION_DATE"/>
  		<result property="modifyDate" column="MODIFED_DATE"/>
  		<result property="bType" column="BOARD_TYPE"/>
  		<result property="status" column="STATUS"/>
  		<result property="mno" column="MEMBER_NO"/>
  		<result property="pno" column="PARKING_NO"/>
  		
  	</resultMap>
  	
  	<resultMap type="com.kh.tsp.customer.model.vo.Board" id="qnaList">
  		<id property="bno" column="BOARD_NO"/>
  		<result property="bTitle" column="BOARD_TITLE"/>
  		<result property="bContext" column="BOARD_CONTEXT"/>
  		<result property="bViews" column="BOARD_VIEWS"/>
  		<result property="createDate" column="CREATION_DATE"/>
  		<result property="modifyDate" column="MODIFED_DATE"/>
  		<result property="bType" column="BOARD_TYPE"/>
  		<result property="status" column="STATUS"/>
  		<result property="mno" column="MEMBER_NAME"/>
  		<result property="pno" column="PARKING_NO"/>
  		
  	</resultMap>
  	
  	<!-- 공지사항 게시물 목록 조회용 쿼리문 -->
  	<select id="boardList" resultMap="boardListSet">
  		SELECT *
  		FROM BOARD B
  		JOIN MEMBER M ON(B.MEMBER_NO = M.MEMBER_NO)
  		WHERE B.STATUS = 'Y'
  		AND B.BOARD_TYPE = '공지'
  		ORDER BY BOARD_NO DESC
  	</select>
  	
  	<!-- 게시물 조회수 증가용 쿼리문 -->
  	<update id="updateBoardCount" parameterType="_int">
  		UPDATE BOARD
  		SET BOARD_VIEWS = (SELECT BOARD_VIEWS FROM BOARD WHERE BOARD_NO = #{bno}) + 1
  		WHERE BOARD_NO = #{bno}
  	</update>
  	
  	<!-- 상세보기 쿼리문 -->
  	<select id="selectOneNotice" parameterType="_int" resultMap="noticeListSet">
  		SELECT *
  		FROM BOARD B
  		JOIN MEMBER M ON (B.MEMBER_NO = M.MEMBER_NO) 
  		WHERE B.BOARD_NO = #{bno}
  		AND B.STATUS = 'Y'
  	</select>
  	
  	<!-- 공지 수정1 쿼리문 -->
  	
  	<select id="updateNotice" parameterType="_int" resultMap="noticeListSet">
  		SELECT *
  		FROM BOARD B
  		JOIN MEMBER M ON (B.MEMBER_NO = M.MEMBER_NO) 
  		WHERE B.BOARD_NO = #{bno}
  		AND B.STATUS = 'Y'
  	</select>
  	
  	<!-- 공지 수정2 쿼리문 -->
  	<update id="updateNotice2" parameterType="Board">
  		UPDATE BOARD
  		SET BOARD_TITLE = #{bTitle}, BOARD_CONTEXT = #{bContext}
  		WHERE BOARD_NO = #{bno}
  		AND STATUS = 'Y'
  		
  	</update>
  	
  	<!-- 공지 삭제 쿼리문 -->
  	<update id="deleteNotice" parameterType="_int">
  		UPDATE BOARD
  		SET STATUS = 'N'
  		WHERE BOARD_NO = #{bno}
  	</update>
  	
  	<!-- 공지 등록 쿼리문 -->
  	<insert id="insertNotice" parameterType="Board">
  		INSERT INTO BOARD
  		VALUES(BNO_SEQ.NEXTVAL, #{bTitle}, #{bContext}, 
  		0, SYSDATE, null, '공지', 'Y', #{mno}, null)
  	</insert>
  	
  	<!-- 내 문의 목록 쿼리문 -->
  	<select id="selectQnaList" resultMap="qnaList">
  		SELECT * FROM BOARD B
  		JOIN MEMBER M ON(B.MEMBER_NO = M.MEMBER_NO)
  		WHERE B.STATUS = 'Y'  		
        AND B.BOARD_TYPE = '관리자문의'
        OR B.BOARD_TYPE = '사업자문의'
  		ORDER BY BOARD_NO DESC
  	</select>
  	
  	<!-- 관리자문의 등록 쿼리문 -->
  	<insert id="insertQna" parameterType="Board">
  		INSERT INTO BOARD
  		VALUES(BNO_SEQ.NEXTVAL, #{bTitle}, #{bContext}, 
  		0, SYSDATE, null, '관리자문의', 'Y', #{mno}, null)
  	</insert>
  	
  	<!-- 문의 상세보기 쿼리문 -->
  	<select id="selectOneQna" parameterType="_int" resultMap="qnaList">
  		SELECT *
  		FROM BOARD B
  		JOIN MEMBER M ON (B.MEMBER_NO = M.MEMBER_NO) 
  		WHERE B.BOARD_NO = #{bno}
  		AND B.STATUS = 'Y'
  	</select>
  	
  	<!-- 문의 수정1 쿼리문 -->
  	
  	<select id="updateQna" parameterType="_int" resultMap="qnaList">
  		SELECT *
  		FROM BOARD B
  		JOIN MEMBER M ON (B.MEMBER_NO = M.MEMBER_NO) 
  		WHERE B.BOARD_NO = #{bno}
  		AND B.STATUS = 'Y'
  	</select>
  	
  	<!-- 공지 수정2 쿼리문 -->
  	<update id="updateQna2" parameterType="Board">
  		UPDATE BOARD
  		SET BOARD_TITLE = #{bTitle}, BOARD_CONTEXT = #{bContext}
  		WHERE BOARD_NO = #{bno}
  		AND STATUS = 'Y'
  		
  	</update>
  	
  	<!-- 문의 삭제 쿼리문 -->
  	<update id="deleteQna2" parameterType="_int">
  		UPDATE BOARD
  		SET STATUS = 'N'
  		WHERE BOARD_NO = #{bno}
  		
  	</update>
  </mapper>