<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MemberAdmin">
	<resultMap type="com.kh.tsp.admin.model.vo.MemberAdmin" id="MemberAdminResultSet">
			<id property="memberNo" column="MEMBER_NO"/>
			<result property="memberId" column="MEMBER_ID"/>
			<result property="memberPassword" column="MEMBER_PASSWORD"/>
			<result property="memberType" column="MEMBER_TYPE"/>
			<result property="idType" column="ID_TYPE"/>
			<result property="oil" column="OIL"/>
			<result property="email" column="EMAIL"/>
			<result property="phone" column="PHONE"/>
			<result property="memberName" column="MEMBER_NAME"/>
			<result property="memberCarNo" column="MEMBER_CARNO"/>
			<result property="status" column="STATUS"/>
			<result property="kakaoId" column="KAKAO_ID"/>
			<result property="bankId" column="BANK_ID"/>
			<result property="bankName" column="BANK_NAME"/>
			<result property="enrollDate" column="ENROLL_DATE"/>	
	</resultMap>
	
	<!-- 사업자 수 -->
  	<select id="getListCount" resultType="_int">
  		SELECT COUNT(*) FROM MEMBER
  		WHERE MEMBER_TYPE='B'
  	</select>
  	
  	<!-- 사업자 리스트 -->
  	<select id="selectParkingCEOList" resultMap="MemberAdminResultSet">		
		SELECT DISTINCT M.MEMBER_NO, M.MEMBER_ID, M.MEMBER_NAME, M.PHONE, M.EMAIL, M.STATUS, (SELECT SUM(OIL) FROM OIL_LIST WHERE MEMBER_NO=M.MEMBER_NO GROUP BY MEMBER_NO) AS OIL
		FROM MEMBER M 
		LEFT OUTER JOIN OIL_LIST O ON(M.MEMBER_NO=O.MEMBER_NO)
		WHERE M.MEMBER_TYPE='B'
		ORDER BY M.MEMBER_NO DESC
  	</select>
  	
  	<!-- 회원 탈퇴 -->
  	<update id="deleteParkingCEO"  parameterType="String">
  		UPDATE MEMBER
  		SET STATUS = 'N'
  		WHERE MEMBER_TYPE='B' AND STATUS='Y' AND MEMBER_NO = #{memberNo}
  	</update>
  	
  	<!-- 회원 복구 -->
  	<update id="updateRecoverParkingCEO"  parameterType="String">
  		UPDATE MEMBER
  		SET STATUS = 'Y'
  		WHERE MEMBER_TYPE='B' AND STATUS='N' AND MEMBER_NO = #{memberNo}
  	</update>
  	
  	<!-- 사업자 리스트 -->
  	<select id="selectSearchParkingCEOList" resultMap="MemberAdminResultSet" parameterType="java.util.Map">		
		SELECT DISTINCT M.MEMBER_NO, M.MEMBER_ID, M.MEMBER_NAME, M.PHONE, M.EMAIL, M.STATUS, (SELECT SUM(OIL) FROM OIL_LIST WHERE MEMBER_NO=M.MEMBER_NO GROUP BY MEMBER_NO) AS OIL
		FROM MEMBER M 
		LEFT OUTER JOIN OIL_LIST O ON(M.MEMBER_NO=O.MEMBER_NO)
		WHERE M.MEMBER_TYPE='B'
		AND M.STATUS =#{selectStatus}
		OR ( M.STATUS != #{selectStatus} and M.MEMBER_ID=#{memberId})
		OR (M.MEMBER_ID != #{memberId} and M.ENROLL_DATE between #{startDate} and #{endDate} )
		ORDER BY M.MEMBER_NO DESC
  	</select>

</mapper>